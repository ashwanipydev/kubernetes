<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kubernetes Captain's Log | 30-Day Mastery</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Inter:wght@300;400;600;700&display=swap');

        body {
            font-family: 'Inter', sans-serif;
            background-color: #fafaf9; /* stone-50 */
            color: #44403c; /* stone-700 */
        }
        
        .font-mono {
            font-family: 'JetBrains Mono', monospace;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f5f5f4; 
        }
        ::-webkit-scrollbar-thumb {
            background: #d6d3d1; 
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #a8a29e; 
        }

        .chart-wrapper {
            position: relative;
            width: 100%;
            max-width: 500px;
            height: 300px;
            max-height: 400px;
            margin: 0 auto;
        }

        .fade-in {
            animation: fadeIn 0.3s ease-in-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .nav-item.active {
            background-color: #e7e5e4; /* stone-200 */
            border-right: 3px solid #ea580c; /* orange-600 */
            font-weight: 600;
        }

        /* Modal Styles */
        .modal-overlay {
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
        }
    </style>
</head>
<body class="h-screen flex overflow-hidden">

    <!-- Sidebar Navigation -->
    <aside class="w-64 bg-stone-100 border-r border-stone-200 flex-shrink-0 flex flex-col justify-between hidden md:flex">
        <div>
            <div class="p-6 border-b border-stone-200">
                <h1 class="text-xl font-bold text-stone-800 flex items-center gap-2">
                    <span class="text-2xl">‚ò∏</span> K8s Log
                </h1>
                <p class="text-xs text-stone-500 mt-1">30-Day Mastery Plan</p>
            </div>
            <nav class="mt-4 flex flex-col gap-1" id="nav-container">
                <!-- Nav items injected by JS -->
            </nav>
        </div>
        <div class="p-4 border-t border-stone-200 bg-stone-50">
            <div class="flex items-center justify-between mb-2">
                <span class="text-xs font-semibold text-stone-500 uppercase tracking-wider">Progress</span>
                <span id="progress-text" class="text-xs font-bold text-orange-600">0%</span>
            </div>
            <div class="w-full bg-stone-200 rounded-full h-2.5">
                <div id="progress-bar" class="bg-orange-600 h-2.5 rounded-full transition-all duration-500" style="width: 0%"></div>
            </div>
        </div>
    </aside>

    <!-- Mobile Header -->
    <div class="md:hidden absolute top-0 left-0 w-full bg-stone-100 border-b border-stone-200 p-4 z-20 flex justify-between items-center">
        <h1 class="text-lg font-bold">K8s Log</h1>
        <button id="mobile-menu-btn" class="text-stone-600 focus:outline-none">‚ò∞</button>
    </div>

    <!-- Mobile Menu Overlay -->
    <div id="mobile-menu" class="fixed inset-0 bg-stone-100 z-30 transform translate-x-full transition-transform duration-300 md:hidden flex flex-col p-6">
        <div class="flex justify-end mb-6">
            <button id="close-menu-btn" class="text-2xl">√ó</button>
        </div>
        <nav id="mobile-nav-container" class="flex flex-col gap-4 text-lg">
            <!-- Mobile nav items injected JS -->
        </nav>
    </div>

    <!-- Main Content Area -->
    <main class="flex-1 overflow-y-auto p-4 md:p-8 pt-20 md:pt-8 bg-stone-50 relative">
        <div id="content-area" class="max-w-5xl mx-auto fade-in">
            <!-- Dynamic Content Loaded Here -->
        </div>
    </main>

    <!-- AI Modal -->
    <div id="ai-modal" class="fixed inset-0 z-50 hidden flex items-center justify-center p-4 modal-overlay">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-2xl max-h-[80vh] flex flex-col overflow-hidden">
            <div class="p-6 border-b border-stone-100 flex justify-between items-center bg-stone-50">
                <h2 id="modal-title" class="text-xl font-bold text-stone-800 flex items-center gap-2"></h2>
                <button onclick="closeModal()" class="text-stone-400 hover:text-stone-600 text-2xl">&times;</button>
            </div>
            <div id="modal-body" class="p-6 overflow-y-auto prose prose-stone max-w-none text-stone-700">
                <!-- AI Response Injected Here -->
            </div>
            <div id="modal-footer" class="p-4 border-t border-stone-100 bg-stone-50 flex justify-end">
                <button onclick="closeModal()" class="px-6 py-2 bg-stone-800 text-white rounded-lg font-medium hover:bg-stone-900 transition-colors">Close</button>
            </div>
        </div>
    </div>

    <script>
        const apiKey = "";
        const GEMINI_MODEL = "gemini-2.5-flash-preview-09-2025";

        const planData = {
            overview: {
                id: 'overview',
                title: 'Mission Dashboard',
                icon: 'üìä',
                description: 'Welcome to your 30-day Kubernetes mastery journey. This dashboard tracks your progress across five key competency domains defined in the official roadmap.'
            },
            prereqs: {
                id: 'prereqs',
                title: 'Phase 0: Prerequisites',
                subtitle: 'Days 1-2',
                icon: 'üèóÔ∏è',
                description: 'Fundamentals of containerization and cluster architecture.',
                days: [
                    { 
                        day: 1, 
                        topic: 'Container Fundamentals', 
                        desc: 'Mastering Docker and the OCI standard.', 
                        exercise: 'Build a multi-stage Dockerfile for a Node.js app, optimize layers, and run it locally.', 
                        domain: 'Basics',
                        concepts: ['Images', 'Layers', 'Registry', 'Volumes', 'Networking', 'Multi-stage builds', 'OCI Compliance', 'Namespaces', 'Cgroups', 'Daemon vs Rootless', 'BuildKit', 'Contexts', 'Environment Variables', 'Entrypoint vs Cmd', 'Signal Handling', 'Layer Caching', 'Distroless Images', 'Scanning', 'Tagging Strategy', 'Docker Compose']
                    },
                    { 
                        day: 2, 
                        topic: 'K8s Architecture', 
                        desc: 'The internal mechanics of the orchestration engine.', 
                        exercise: 'Trace a request from kubectl to the Kubelet on a diagram.', 
                        domain: 'Basics',
                        concepts: ['API Server', 'etcd', 'Scheduler', 'Controller Manager', 'Kubelet', 'Kube-proxy', 'Control Plane', 'Worker Nodes', 'CRI', 'CNI', 'CSI', 'Admission Controllers', 'Cloud Controller', 'High Availability', 'Heartbeats', 'Watch Mechanism', 'Declarative State', 'Reconciliation Loop', 'Resource Versioning', 'Object Meta']
                    }
                ]
            },
            week1: {
                id: 'week1',
                title: 'Phase 1: Core Workloads',
                subtitle: 'Days 3-7',
                icon: 'üì¶',
                description: 'Building and managing application lifecycle.',
                days: [
                    { day: 3, topic: 'Cluster Setup', desc: 'Environment configuration.', exercise: 'Install minikube/kind and configure multiple contexts.', domain: 'Basics', concepts: ['Kubeconfig', 'Contexts', 'Namespaces', 'API Resources', 'Verbs', 'Dry-run', 'Output formats', 'Explain command', 'Aliases', 'Auto-completion', 'Cluster-info', 'Minikube profiles', 'Kind clusters', 'Node status', 'Component health', 'Version skew', 'Plugins', 'Krew', 'Metrics Server', 'Dashboard'] },
                    { day: 4, topic: 'Pods Deep Dive', desc: 'The atomic unit.', exercise: 'Deploy a multi-container pod with shared volumes and inter-container communication.', domain: 'Workloads', concepts: ['Pod Lifecycle', 'Pending/Running/Succeeded', 'Failed/Unknown', 'Restart Policy', 'Container Port', 'ImagePullPolicy', 'Shared Volume', 'EmptyDir', 'Init Containers', 'Sidecars', 'Ephemeral Containers', 'Termination Grace Period', 'PreStop Hooks', 'PostStart Hooks', 'Status vs Spec', 'Conditions', 'NodeSelector', 'Tolerations', 'Affinity', 'DNS Policy'] },
                    { day: 5, topic: 'YAML & Templates', desc: 'Declarative management.', exercise: 'Convert imperative commands into modular YAML files.', domain: 'Basics', concepts: ['API Versioning', 'Kind', 'Metadata', 'Labels', 'Annotations', 'Selectors', 'MatchLabels', 'Field Selectors', 'Templates', 'Validation', 'Formatting', 'Comments', 'Multi-doc YAML', 'Patching', 'Merge Strategy', 'Replace vs Apply', 'Kustomize basics', 'Diffing', 'Owner References', 'Finalizers'] },
                    { day: 6, topic: 'ReplicaSets', desc: 'Ensuring desired state.', exercise: 'Scalability testing and self-healing verification.', domain: 'Workloads', concepts: ['Desired Replicas', 'Current Replicas', 'Ready Replicas', 'Scaling', 'Auto-healing', 'Label Selection', 'Orphan Pods', 'Adopting Pods', 'Cascading Delete', 'Non-cascading Delete', 'History', 'Spec Hashing', 'Selectors Logic', 'Template Updates', 'Resource Usage', 'Controller Loop', 'Event Logging', 'High Availability', 'Disruption Budgets', 'Concurrency'] },
                    { day: 7, topic: 'Deployments', desc: 'Application release cycles.', exercise: 'Trigger a rolling update and execute a manual rollback.', domain: 'Workloads', concepts: ['RollingUpdate', 'Recreate', 'MaxSurge', 'MaxUnavailable', 'Revision History', 'Rollback', 'Pause/Resume', 'Status Tracking', 'Probes Interaction', 'Progress Deadline', 'Blue-Green Basics', 'Canary Basics', 'Record Flag', 'Annotations Impact', 'Deployment Controller', 'Scale Subresource', 'Lifecycle Management', 'Stability', 'Readiness Gates', 'MinReadySeconds'] }
                ]
            },
            week2: {
                id: 'week2',
                title: 'Phase 2: Network & Storage',
                subtitle: 'Days 8-14',
                icon: 'üåê',
                description: 'Connectivity and persistence.',
                days: [
                    { day: 8, topic: 'Internal Services', desc: 'ClusterIP and Service Discovery.', exercise: 'Setup frontend/backend communication using DNS.', domain: 'Network', concepts: ['ClusterIP', 'Service DNS', 'CoreDNS', 'Endpoints', 'EndpointSlices', 'Kube-proxy modes', 'IPTables', 'IPVS', 'Virtual IP', 'Session Affinity', 'Selectors', 'Headless Services', 'ExternalName', 'Service Port', 'Target Port', 'Node Port Mapping', 'Named Ports', 'SRV Records', 'FQDN', 'Service Discovery'] },
                    { day: 9, topic: 'External Services', desc: 'Edge connectivity.', exercise: 'Expose a service via NodePort and LoadBalancer.', domain: 'Network', concepts: ['NodePort', 'LoadBalancer', 'ExternalIPs', 'ExternalTrafficPolicy', 'Local vs Cluster', 'Cloud Provider Integration', 'MetalLB', 'Service Controller', 'Traffic Distribution', 'Health Checks', 'Firewall Rules', 'Static IPs', 'DNS Integration', 'Port Ranges', 'Protocol Support', 'SCTP/UDP', 'Topology Keys', 'IPv4/IPv6 Dual Stack', 'Service CIDR', 'NodePort Ranges'] },
                    { day: 10, topic: 'Ingress', desc: 'Layer 7 routing.', exercise: 'Deploy Nginx Ingress with path-based routing.', domain: 'Network', concepts: ['Ingress Controller', 'Ingress Resource', 'Path Matching', 'Host Matching', 'TLS Termination', 'Cert-Manager', 'Default Backend', 'Annotations', 'Rewrite Rules', 'Rate Limiting', 'Authentication', 'Sticky Sessions', 'Load Balancing Algorithms', 'Wildcard Hosts', 'Class Names', 'Implementation Differences', 'Debugging Ingress', 'Virtual Hosts', 'SNI', 'Access Logs'] },
                    { day: 11, topic: 'ConfigMaps', desc: 'Externalizing config.', exercise: 'Mount a configuration file into a Pod.', domain: 'Storage', concepts: ['Key-Value Pairs', 'Data vs BinaryData', 'Env Variables', 'Volume Mounts', 'SubPath', 'Dynamic Updates', 'Refresh Intervals', 'Immutable ConfigMaps', 'Size Limits', 'Namespacing', 'Literal vs File', 'Directory Injection', 'Projected Volumes', 'Environment Injection', 'ConfigMap API', 'Cross-namespace limits', 'Validation', 'Versioning Config', 'Templates Integration', 'Security Best Practices'] },
                    { day: 12, topic: 'Secrets', desc: 'Sensitive data.', exercise: 'Securely inject DB credentials.', domain: 'Storage', concepts: ['Base64 Encoding', 'Encryption at Rest', 'Opaque', 'DockerConfigJson', 'ServiceAccountToken', 'TLS Secret', 'Mounted Secrets', 'Env Secret', 'RBAC for Secrets', 'External Secrets API', 'KMS Integration', 'CSI Secret Store', 'Immutable Secrets', 'Secret Rotation', 'Memory Storage', 'Data Encryption Keys', 'Audit Logs', 'Namespace Scoping', 'Size Constraints', 'Leak Prevention'] },
                    { day: 13, topic: 'Persistent Volumes', desc: 'Static storage.', exercise: 'Create a PV and PVC manually.', domain: 'Storage', concepts: ['PV Lifecycle', 'PVC Binding', 'Access Modes', 'ReadWriteOnce', 'ReadWriteMany', 'ReadOnlyMany', 'Reclaim Policy', 'Retain/Delete/Recycle', 'Volume Phases', 'Capacity Planning', 'Static Provisioning', 'Storage Backend', 'NFS/HostPath', 'Node Affinity', 'Binding Logic', 'Volume Limits', 'Cleanup', 'Stateful Persistence', 'Selector/MatchLabel', 'Claims'] },
                    { day: 14, topic: 'Dynamic Storage', desc: 'Automating persistence.', exercise: 'Use StorageClasses for on-demand volumes.', domain: 'Storage', concepts: ['StorageClass', 'Provisioners', 'Parameters', 'WaitFirstConsumer', 'Immediate Binding', 'Expansion Support', 'Snapshot Support', 'CSI Drivers', 'Volume Attributes', 'Default StorageClass', 'Cloud Storage Integration', 'Local PV Provisioning', 'Topology Awareness', 'IOPS Tuning', 'Mount Options', 'FSType', 'Encrypted Volumes', 'Backups', 'Volume Health', 'Migration'] }
                ]
            },
            week3: {
                id: 'week3',
                title: 'Phase 3: Advanced Workloads',
                subtitle: 'Days 15-21',
                icon: 'üîí',
                description: 'State, scale, and security.',
                days: [
                    { day: 15, topic: 'StatefulSets', desc: 'Managing stateful apps.', exercise: 'Deploy a replicated MongoDB cluster.', domain: 'Workloads', concepts: ['Ordinal Index', 'Stable Network ID', 'Headless Service', 'VolumeClaimTemplates', 'OrderedReady', 'Parallel Pod Management', 'Update Strategies', 'Partitioned Updates', 'PVC Retention', 'Identity Maintenance', 'Quorum Basics', 'Data Consistency', 'Graceful Scale Down', 'Draining Nodes', 'Storage per Pod', 'Peering', 'Clustering Logic', 'Pod Management Policy', 'Rollback Challenges', 'Snapshot Integration'] },
                    { day: 16, topic: 'DaemonSets', desc: 'Node-level agents.', exercise: 'Deploy a logging agent on all nodes.', domain: 'Workloads', concepts: ['One Pod per Node', 'Scheduling Logic', 'Taints/Tolerations Interaction', 'Update Strategy', 'OnDelete vs RollingUpdate', 'NodeSelectors', 'System Reserved', 'Log Aggregation', 'Monitoring Agents', 'CNI Pods', 'Kube-proxy DS', 'Node Labels', 'Static Pods comparison', 'Resource Management', 'Critical Pods', 'Health Checking', 'Excluding Nodes', 'Cloud Scaling Impact', 'Controller Logic', 'History Limit'] },
                    { day: 17, topic: 'Jobs/CronJobs', desc: 'Batch processing.', exercise: 'Schedule a database backup task.', domain: 'Workloads', concepts: ['Parallelism', 'Completions', 'ActiveDeadlineSeconds', 'BackoffLimit', 'RestartPolicy', 'Cron Expression', 'Schedule History', 'Suspend', 'Concurrency Policy', 'StartingDeadlineSeconds', 'Job Controller', 'Pod Failure Policy', 'Indexing Jobs', 'Cleanup Policy', 'Sidecar Termination', 'Resource Cleanup', 'Success Criteria', 'Logging Batch Jobs', 'TTL Controller', 'Manual Triggering'] },
                    { day: 18, topic: 'Resources/Quotas', desc: 'Efficiency.', exercise: 'Apply resource constraints to a namespace.', domain: 'Ops', concepts: ['CPU Requests', 'Memory Requests', 'CPU Limits', 'Memory Limits', 'QoS Classes', 'Guaranteed/Burstable/BestEffort', 'OOM Killer', 'CPU Throttling', 'ResourceQuota', 'LimitRange', 'Default Requests', 'Scope Selectors', 'Extended Resources', 'GPU Support', 'Node Allocatable', 'Vertical Pod Autoscaler', 'Goldilocks', 'Cost Optimization', 'Downward API', 'Cgroups v2'] },
                    { day: 19, topic: 'RBAC', desc: 'Access control.', exercise: 'Create a read-only developer role.', domain: 'Security', concepts: ['Role', 'ClusterRole', 'RoleBinding', 'ClusterRoleBinding', 'Subjects', 'ServiceAccounts', 'Users/Groups', 'Verbs', 'API Groups', 'Resource Names', 'Aggregated ClusterRoles', 'Default Roles', 'Impersonation', 'Token Request API', 'Bound Service Account Tokens', 'Authn vs Authz', 'Admission Plugins', 'Certificate Signing', 'Audit Logs', 'Least Privilege'] },
                    { day: 20, topic: 'Network Policies', desc: 'Microsegmentation.', exercise: 'Isolate database traffic.', domain: 'Network', concepts: ['Ingress Rules', 'Egress Rules', 'PodSelectors', 'NamespaceSelectors', 'IPBlock', 'Policy Types', 'Default Deny', 'Allow Listing', 'CNI Support', 'Cilium/Calico', 'Logging Flow', 'Debugging Policies', 'Port Definitions', 'Protocol', 'Label Matching', 'Isolation Level', 'Peer Definitions', 'Policy Overlap', 'Hierarchical Policies', 'Service Mesh overlap'] },
                    { day: 21, topic: 'Pod Security', desc: 'Hardening.', exercise: 'Apply Pod Security Standards.', domain: 'Security', concepts: ['Privileged Containers', 'HostNetwork/PID/IPC', 'ReadOnlyRootFilesystem', 'RunAsUser', 'RunAsGroup', 'FSGroup', 'AllowPrivilegeEscalation', 'Capabilities', 'SELinux', 'AppArmor', 'Seccomp Profiles', 'Pod Security Admission', 'Privileged/Baseline/Restricted', 'Namespace Labels', 'Admission Webhooks', 'SecurityContext', 'Volume Security', 'HostPath Risks', 'Sysctls', 'Container Runtime Security'] }
                ]
            },
            week4: {
                id: 'week4',
                title: 'Phase 4: Production & Beyond',
                subtitle: 'Days 22-30',
                icon: 'üî≠',
                description: 'Ops, Observability, and Day 2.',
                days: [
                    { day: 22, topic: 'Probes Deep Dive', desc: 'Health management.', exercise: 'Design a multi-stage startup/liveness flow.', domain: 'Ops', concepts: ['LivenessProbe', 'ReadinessProbe', 'StartupProbe', 'HTTPGet', 'TCPSocket', 'Exec', 'GRPC Probes', 'InitialDelaySeconds', 'PeriodSeconds', 'TimeoutSeconds', 'SuccessThreshold', 'FailureThreshold', 'Termination Grace Period', 'Probe Overlap', 'Application Warmup', 'Dependency Checking', 'Endpoint Management', 'Pod Lifecycle', 'Restart Loop Prevention', 'Container Health'] },
                    { day: 23, topic: 'HPA/VPA', desc: 'Autoscaling.', exercise: 'Load test an app to trigger scaling.', domain: 'Ops', concepts: ['Metrics Server', 'HPA Controller', 'CPU Utilization', 'Memory Utilization', 'Custom Metrics', 'Prometheus Adapter', 'Scaling Policies', 'Cooldown/Delay', 'Stabilization Window', 'VPA Recommender', 'VPA Updater', 'UpdateMode', 'Admission Controller', 'Resource Histograms', 'Scaling Limits', 'KEDA basics', 'External Metrics', 'Cluster Autoscaler', 'Node Provisioning', 'Scale-to-Zero'] },
                    { day: 24, topic: 'Scheduling Control', desc: 'Pod placement.', exercise: 'Isolate workloads on specific nodes.', domain: 'Ops', concepts: ['NodeAffinity', 'PodAffinity', 'PodAntiAffinity', 'Soft vs Hard Rules', 'TopologyKeys', 'Taints', 'Tolerations', 'NoSchedule', 'PreferNoSchedule', 'NoExecute', 'NodeSelector', 'Scheduler Profiles', 'Custom Schedulers', 'Preemption', 'PriorityClasses', 'Descheduler', 'Bin Packing', 'Spread Constraints', 'Inter-pod constraints', 'Multi-zone scheduling'] },
                    { day: 25, topic: 'Helm Mastery', desc: 'Packaging.', exercise: 'Create a custom Helm chart for your API.', domain: 'Ops', concepts: ['Chart Structure', 'Values.yaml', 'Templates', 'Helpers', 'Dry-run/Debug', 'Release Management', 'Rollback', 'Charts Repositories', 'Dependencies', 'Library Charts', 'Helm Hooks', 'Release Secrets', 'Chart Versioning', 'App Versioning', 'Templating Functions', 'Control Structures', 'Chart Testing', 'ArtifactHub', 'Helm Plugins', 'OCI Distribution'] },
                    { day: 26, topic: 'Logging & Tracing', desc: 'Observability.', exercise: 'Aggregate logs using EFK/PLG.', domain: 'Ops', concepts: ['Stdout/Stderr', 'Log Rotation', 'Sidecar Logging', 'Fluentd/Fluentbit', 'Loki', 'Elasticsearch', 'Kibana', 'Promtail', 'Log Parsing', 'Structured Logging', 'Distributed Tracing', 'Jaeger', 'OpenTelemetry', 'Collector', 'Instrumentation', 'Sampling', 'Spans/Contexts', 'Propagation', 'Storage Backends', 'Visualization'] },
                    { day: 27, topic: 'Metrics/Monitoring', desc: 'Health visibility.', exercise: 'Build a custom Grafana dashboard.', domain: 'Ops', concepts: ['Prometheus Architecture', 'ServiceMonitor', 'PodMonitor', 'PromQL', 'Alertmanager', 'Recording Rules', 'Exporters', 'Node Exporter', 'Kube-state-metrics', 'Grafana Dashboards', 'Alerting Policies', 'Pushgateway', 'Thanos/Cortex', 'Long-term Storage', 'Cardinality', 'Metrics Types', 'Scrape Configuration', 'Relabeling', 'Monitoring Mixins', 'Dashboards as Code'] },
                    { day: 28, topic: 'Workload Debugging', desc: 'Fixing errors.', exercise: 'Solve a networking and storage failure.', domain: 'Ops', concepts: ['Describe command', 'Logs command', 'Events', 'Exec/Debug', 'Port-forward', 'Proxy', 'Ephemeral Containers', 'Packet Capture', 'Network Troubleshooting', 'DNS Debugging', 'Storage Mounting Issues', 'Image Pull Secrets', 'Resource Exhaustion', 'Crashed Containers', 'OOMKilled', 'Node Pressure', 'CRI Errors', 'Admission Failures', 'RBAC Denials', 'Service Mismatch'] },
                    { day: 29, topic: 'Cluster Maintenance', desc: 'Admin tasks.', exercise: 'Simulate a node drain and upgrade.', domain: 'Ops', concepts: ['Cordon/Uncordon', 'Drain', 'Node Eviction', 'PDBs', 'Static Pods', 'Kubeadm Upgrade', 'ETCD Backup/Restore', 'Cert Rotation', 'Node Lifecycle', 'Kubelet Logs', 'Systemd Units', 'Kernel Tuning', 'OS Hardening', 'Node Problem Detector', 'Garbage Collection', 'Disk Pressure', 'Pressure Stall Information', 'Cluster Lifecycle', 'High Availability Testing', 'Disaster Recovery'] },
                    { day: 30, topic: 'GitOps & Service Mesh', desc: 'Future trends.', exercise: 'Research ArgoCD and Istio flows.', domain: 'Ops', concepts: ['GitOps Principles', 'ArgoCD', 'Flux', 'Reconciliation', 'Sync Policies', 'Drift Detection', 'Service Mesh', 'Istio/Linkerd', 'Sidecar Injection', 'mTLS', 'Traffic Splitting', 'Circuit Breaking', 'Fault Injection', 'Observability Mesh', 'Gateway API', 'Multi-cluster', 'Federation', 'Cluster API', 'Serverless K8s', 'WebAssembly'] }
                ]
            }
        };

        const state = {
            currentView: 'overview',
            completedDays: new Set(),
            isGenerating: false
        };

        // --- Gemini API Logic ---

        async function callGemini(prompt, systemPrompt) {
            state.isGenerating = true;
            document.getElementById('modal-body').innerHTML = '<div class="flex flex-col items-center py-12"><div class="animate-spin rounded-full h-12 w-12 border-b-2 border-orange-600 mb-4"></div><p class="text-stone-500 animate-pulse">Gemini is thinking...</p></div>';
            
            const url = `https://generativelanguage.googleapis.com/v1beta/models/${GEMINI_MODEL}:generateContent?key=${apiKey}`;
            const payload = {
                contents: [{ parts: [{ text: prompt }] }],
                systemInstruction: { parts: [{ text: systemPrompt }] }
            };

            let retryCount = 0;
            const delays = [1000, 2000, 4000, 8000, 16000];

            while (retryCount < 5) {
                try {
                    const response = await fetch(url, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    
                    if (!response.ok) throw new Error('API Error');
                    
                    const result = await response.json();
                    state.isGenerating = false;
                    return result.candidates?.[0]?.content?.parts?.[0]?.text;
                } catch (e) {
                    await new Promise(res => setTimeout(res, delays[retryCount]));
                    retryCount++;
                }
            }
            state.isGenerating = false;
            return "I'm sorry, I'm having trouble connecting to my brain right now. Please try again later.";
        }

        async function generateStudyGuide(dayData) {
            openModal(`‚ú® AI Study Guide: ${dayData.topic}`);
            const systemPrompt = "You are a world-class Kubernetes architect and educator. Provide a deep-dive study guide for the requested topic. Use Markdown. Focus on the 'Core Concepts' provided. Include architecture diagrams using ASCII if helpful, best practices, and common interview questions.";
            const prompt = `Topic: ${dayData.topic}\nDescription: ${dayData.desc}\nCore Concepts: ${dayData.concepts.join(', ')}\nExercise: ${dayData.exercise}`;
            
            const response = await callGemini(prompt, systemPrompt);
            document.getElementById('modal-body').innerHTML = formatMarkdown(response);
        }

        async function generateQuiz(dayData) {
            openModal(`‚ú® AI Exam Simulator: Day ${dayData.day}`);
            const systemPrompt = "Generate a 3-question challenging technical quiz based on the Kubernetes concepts provided. Each question should be multiple choice. Include the correct answer and a detailed explanation for why it is correct. Use Markdown.";
            const prompt = `Concepts to test: ${dayData.concepts.join(', ')}`;
            
            const response = await callGemini(prompt, systemPrompt);
            document.getElementById('modal-body').innerHTML = formatMarkdown(response);
        }

        function formatMarkdown(text) {
            // Simple markdown formatter
            return text
                .replace(/^### (.*$)/gim, '<h3 class="text-lg font-bold mt-4 mb-2">$1</h3>')
                .replace(/^## (.*$)/gim, '<h2 class="text-xl font-bold mt-6 mb-3">$1</h2>')
                .replace(/^# (.*$)/gim, '<h1 class="text-2xl font-bold mt-8 mb-4">$1</h1>')
                .replace(/^\* (.*$)/gim, '<li class="ml-4">$1</li>')
                .replace(/^\d\. (.*$)/gim, '<li class="ml-4 list-decimal">$1</li>')
                .replace(/\*\*(.*)\*\*/gim, '<strong>$1</strong>')
                .replace(/`(.*)`/gim, '<code class="bg-stone-100 px-1 rounded font-mono text-sm">$1</code>')
                .replace(/\n/g, '<br>');
        }

        // --- UI Logic ---

        function openModal(title) {
            document.getElementById('modal-title').innerText = title;
            document.getElementById('ai-modal').classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        }

        function closeModal() {
            document.getElementById('ai-modal').classList.add('hidden');
            document.body.style.overflow = '';
        }

        function init() {
            renderNav();
            renderContent();
            setupMobileMenu();
        }

        function switchView(viewId) {
            state.currentView = viewId;
            renderNav();
            renderContent();
            document.getElementById('mobile-menu').classList.add('translate-x-full');
        }

        function toggleDayCompletion(dayNum) {
            if (state.completedDays.has(dayNum)) {
                state.completedDays.delete(dayNum);
            } else {
                state.completedDays.add(dayNum);
            }
            updateProgress();
            renderContent();
        }

        function updateProgress() {
            const totalDays = 30;
            const percentage = Math.round((state.completedDays.size / totalDays) * 100);
            const bar = document.getElementById('progress-bar');
            const text = document.getElementById('progress-text');
            if(bar && text) {
                bar.style.width = `${percentage}%`;
                text.innerText = `${percentage}%`;
            }
        }

        function renderNav() {
            const container = document.getElementById('nav-container');
            const mobileContainer = document.getElementById('mobile-nav-container');
            const sections = Object.values(planData);
            
            const html = sections.map(section => {
                const isActive = state.currentView === section.id;
                return `
                    <div onclick="switchView('${section.id}')" class="nav-item px-6 py-3 cursor-pointer hover:bg-stone-50 transition-colors flex items-center justify-between group ${isActive ? 'active' : ''}">
                        <div class="flex items-center gap-3">
                            <span>${section.icon}</span>
                            <span class="text-sm font-medium ${isActive ? 'text-stone-900' : 'text-stone-600 group-hover:text-stone-900'}">${section.title}</span>
                        </div>
                    </div>
                `;
            }).join('');
            
            container.innerHTML = html;
            mobileContainer.innerHTML = html;
        }

        function renderContent() {
            const container = document.getElementById('content-area');
            const data = planData[state.currentView];
            if (state.currentView === 'overview') {
                renderDashboard(container, data);
            } else {
                renderPhase(container, data);
            }
        }

        function renderDashboard(container, data) {
            const domainCounts = { Basics: 0, Workloads: 0, Network: 0, Storage: 0, Ops: 0, Security: 0 };
            const allDays = Object.values(planData).filter(p => p.days).flatMap(p => p.days);
            allDays.forEach(d => domainCounts[d.domain]++);
            
            container.innerHTML = `
                <div class="mb-8 flex flex-col md:flex-row md:items-end justify-between gap-4">
                    <div>
                        <h2 class="text-3xl font-bold text-stone-800 mb-2">${data.title}</h2>
                        <p class="text-stone-600 max-w-2xl">${data.description}</p>
                    </div>
                    <div class="bg-orange-600 text-white px-4 py-2 rounded-lg text-sm font-bold shadow-lg shadow-orange-200 cursor-default">
                        READY FOR CKA / CKAD
                    </div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                    <div class="bg-white p-6 rounded-xl shadow-sm border border-stone-100 flex flex-col items-center">
                        <h3 class="text-lg font-semibold text-stone-700 mb-4">Overall Completion</h3>
                        <div class="chart-wrapper"><canvas id="progressChart"></canvas></div>
                    </div>
                    <div class="bg-white p-6 rounded-xl shadow-sm border border-stone-100 flex flex-col items-center">
                        <h3 class="text-lg font-semibold text-stone-700 mb-4">Curriculum Balance</h3>
                        <div class="chart-wrapper"><canvas id="radarChart"></canvas></div>
                    </div>
                </div>
            `;

            setTimeout(() => {
                const comp = state.completedDays.size;
                new Chart(document.getElementById('progressChart'), {
                    type: 'doughnut',
                    data: { labels: ['Done', 'Remaining'], datasets: [{ data: [comp, 30-comp], backgroundColor: ['#ea580c', '#f5f5f4'], borderWidth: 0 }] },
                    options: { maintainAspectRatio: false, cutout: '75%', plugins: { legend: { position: 'bottom' } } }
                });
                new Chart(document.getElementById('radarChart'), {
                    type: 'radar',
                    data: { labels: Object.keys(domainCounts), datasets: [{ label: 'Focus', data: Object.values(domainCounts), fill: true, backgroundColor: 'rgba(234, 88, 12, 0.1)', borderColor: '#ea580c', pointBackgroundColor: '#ea580c' }] },
                    options: { maintainAspectRatio: false, scales: { r: { suggestedMin: 0, ticks: { display: false } } }, plugins: { legend: { display: false } } }
                });
            }, 0);
        }

        function renderPhase(container, data) {
            const daysHtml = data.days.map(day => {
                const isCompleted = state.completedDays.has(day.day);
                return `
                <div class="bg-white rounded-xl shadow-sm border transition-all duration-300 ${isCompleted ? 'border-green-500 shadow-green-50' : 'border-stone-200'} flex flex-col hover:shadow-md">
                    <div class="p-5 flex-1">
                        <div class="flex justify-between items-start mb-3">
                            <span class="px-2 py-1 text-[10px] font-bold bg-stone-100 text-stone-600 rounded uppercase tracking-wider">Day ${day.day}</span>
                            <span class="px-2 py-1 text-[10px] font-bold bg-orange-50 text-orange-600 rounded uppercase tracking-wider">${day.domain}</span>
                        </div>
                        <h3 class="text-lg font-bold text-stone-800 mb-1">${day.topic}</h3>
                        <p class="text-xs text-stone-500 mb-4 leading-relaxed">${day.desc}</p>
                        
                        <div class="mb-4">
                            <h4 class="text-[10px] font-bold text-stone-400 uppercase tracking-widest mb-2">Core Concepts</h4>
                            <div class="flex flex-wrap gap-1">
                                ${day.concepts.map(c => `<span class="text-[9px] px-1.5 py-0.5 bg-stone-50 border border-stone-100 rounded text-stone-500">${c}</span>`).join('')}
                            </div>
                        </div>

                        <div class="flex gap-2 mb-4">
                            <button onclick='generateStudyGuide(${JSON.stringify(day).replace(/'/g, "&apos;")})' class="flex-1 py-2 text-[10px] font-bold bg-stone-50 text-stone-700 rounded-lg border border-stone-200 hover:bg-stone-100 transition-colors">
                                ‚ú® STUDY GUIDE
                            </button>
                            <button onclick='generateQuiz(${JSON.stringify(day).replace(/'/g, "&apos;")})' class="flex-1 py-2 text-[10px] font-bold bg-stone-50 text-stone-700 rounded-lg border border-stone-200 hover:bg-stone-100 transition-colors">
                                ‚ú® EXAM PREP
                            </button>
                        </div>

                        <div class="bg-stone-900 rounded-lg p-3 mt-auto">
                            <p class="text-[10px] text-green-400 font-mono mb-1"># Lab Exercise</p>
                            <p class="text-xs text-stone-300 font-mono leading-tight">${day.exercise}</p>
                        </div>
                    </div>
                    <div class="bg-stone-50 p-3 border-t border-stone-100 flex justify-between items-center">
                        <span class="text-[10px] font-medium text-stone-400">${isCompleted ? 'Completed' : 'Status: Pending'}</span>
                        <button onclick="toggleDayCompletion(${day.day})" class="px-4 py-1.5 text-xs font-bold rounded-full transition-all ${isCompleted ? 'bg-green-500 text-white shadow-lg shadow-green-100' : 'bg-stone-200 text-stone-600 hover:bg-stone-300'}">
                            ${isCompleted ? '‚úì' : 'DONE'}
                        </button>
                    </div>
                </div>
            `}).join('');

            container.innerHTML = `
                <div class="mb-8">
                    <div class="flex items-center gap-4 mb-2">
                        <span class="text-4xl">${data.icon}</span>
                        <h2 class="text-3xl font-bold text-stone-800">${data.title}</h2>
                    </div>
                    <p class="text-stone-500 text-lg max-w-3xl">${data.description}</p>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-12">${daysHtml}</div>
            `;
        }

        function setupMobileMenu() {
            const btn = document.getElementById('mobile-menu-btn');
            const menu = document.getElementById('mobile-menu');
            const close = document.getElementById('close-menu-btn');
            btn.onclick = () => menu.classList.toggle('translate-x-full');
            close.onclick = () => menu.classList.add('translate-x-full');
        }

        init();
    </script>
</body>
</html>